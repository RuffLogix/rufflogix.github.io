---
import { Github, ExternalLink, Calendar, Tag, User, BookOpen } from "lucide-astro";
import OptimizedImage from "./OptimizedImage.astro";
import type { ProjectInformation } from "../types/project.d.ts";

interface Props {
	project: ProjectInformation;
	index: number;
}

const { project, index } = Astro.props;
---

<div
	class="project-card group relative bg-gradient-to-br from-gray-900 to-gray-800 border border-gray-700/50 rounded-2xl shadow-xl overflow-hidden gpu-optimized optimized-transition layout-stable hover:border-emerald-500/50 hover:shadow-2xl hover:shadow-emerald-500/10 hover:-translate-y-2 will-change-transform"
	data-project-index={index}
>
	<!-- Enhanced Image Section with Overlay Info -->
	<div class="relative h-56 bg-gradient-to-br from-gray-700 to-gray-800 overflow-hidden img-container">
		<OptimizedImage
			src={project.image}
			alt={`${project.title} cover`}
			class="w-full h-full object-cover group-hover:scale-110 gpu-optimized transition-transform duration-700 ease-out"
			loading={index < 6 ? "eager" : "lazy"}
			fetchpriority={index < 3 ? "high" : "auto"}
			sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"
		/>
		
		<!-- Gradient Overlays -->
		<div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/40 to-transparent"></div>
		<div class="absolute inset-0 bg-gradient-to-br from-transparent to-gray-900/60"></div>
		
		<!-- Floating Category Badge -->
		<div class="absolute top-4 right-4">
			<div class="bg-emerald-500/90 backdrop-blur-md text-white px-3 py-1.5 rounded-full text-xs font-bold shadow-lg border border-emerald-400/20">
				<Tag size={10} class="inline mr-1" />
				{project.category}
			</div>
		</div>
		
		<!-- Date Badge -->
		<div class="absolute top-4 left-4">
			<div class="bg-gray-900/80 backdrop-blur-md text-gray-300 px-3 py-1.5 rounded-full text-xs font-medium shadow-lg border border-gray-700/50">
				<Calendar size={10} class="inline mr-1" />
				{project.date}
			</div>
		</div>
		
		<!-- Title Overlay -->
		<div class="absolute bottom-4 left-4 right-4">
			<h3 class="text-2xl font-bold text-white mb-1 drop-shadow-lg group-hover:text-emerald-300 transition-colors duration-300">
				{project.title}
			</h3>
			<div class="flex items-center text-emerald-400 text-sm font-medium">
				<User size={12} class="mr-1" />
				{project.role}
			</div>
		</div>
	</div>

	<!-- Enhanced Content Section -->
	<div class="p-6 space-y-4">
		<!-- Description -->
		<p class="text-gray-300 text-sm leading-relaxed line-clamp-3 group-hover:text-gray-200 transition-colors duration-300">
			{project.description}
		</p>

		<!-- Enhanced Tech Stack Display -->
		<div class="space-y-2">
			<h4 class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Tech Stack</h4>
			<div class="flex flex-wrap gap-2">
				{
					project.tags
						.slice(0, 5)
						.map((tag, tagIndex) => (
							<span class={`
								px-3 py-1.5 rounded-lg text-xs font-medium transition-all duration-300 cursor-default
								${tagIndex % 3 === 0 
									? 'bg-blue-500/20 text-blue-300 border border-blue-500/30 hover:bg-blue-500/30' 
									: tagIndex % 3 === 1 
									? 'bg-purple-500/20 text-purple-300 border border-purple-500/30 hover:bg-purple-500/30'
									: 'bg-pink-500/20 text-pink-300 border border-pink-500/30 hover:bg-pink-500/30'
								}
							`}>
								{tag}
							</span>
						))
				}
				{
					project.tags.length > 5 && (
						<span class="px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-700/50 text-gray-400 border border-gray-600/50">
							+{project.tags.length - 5} more
						</span>
					)
				}
			</div>
		</div>

		<!-- Enhanced Action Buttons -->
		<div class="flex items-center gap-3 pt-2">
			{
				project.infoLink && (
					<a
						href={project.infoLink}
						target="_blank"
						rel="noopener noreferrer"
						class="flex-1 flex items-center justify-center gap-2 bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white px-4 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 hover:shadow-lg hover:shadow-emerald-500/25 hover:-translate-y-0.5"
						title="View Live Demo"
					>
						<ExternalLink size={16} />
						Live Demo
					</a>
				)
			}
			{
				project.articleLink && (
					<a
						href={project.articleLink}
						target="_blank"
						rel="noopener noreferrer"
						class="flex items-center gap-1.5 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-400 text-white px-3 py-2.5 rounded-xl text-sm font-medium transition-all duration-300 hover:shadow-lg hover:shadow-orange-500/25 hover:-translate-y-0.5"
						title="Read Article on Medium"
					>
						<BookOpen size={16} />
						Article
					</a>
				)
			}
			{
				project.githubLinks && project.githubLinks.length > 0 && (
					<div class="flex items-center gap-2">
						{project.githubLinks.slice(0, 2).map((repo, idx) => (
							<a
								href={repo.url}
								target="_blank"
								rel="noopener noreferrer"
								class="flex items-center gap-1.5 bg-gray-700/80 hover:bg-gray-600 text-gray-300 hover:text-white px-3 py-2.5 rounded-xl text-sm font-medium transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 border border-gray-600/50 hover:border-gray-500"
								title={`${repo.label} Repository`}
							>
								<Github size={16} />
								{project.githubLinks!.length === 1
									? "Code"
									: repo.label.split(' ')[0]}
							</a>
						))}
						{project.githubLinks.length > 2 && (
							<div class="relative group/tooltip">
								<div class="flex items-center justify-center w-10 h-10 bg-gray-700/50 hover:bg-gray-600 text-gray-400 hover:text-white rounded-xl text-xs font-medium border border-gray-600/50 hover:border-gray-500 cursor-pointer transition-all duration-300">
									+{project.githubLinks.length - 2}
								</div>
								
								<!-- Tooltip with Links -->
								<div class="absolute bottom-full right-0 mb-3 opacity-0 invisible group-hover/tooltip:opacity-100 group-hover/tooltip:visible transition-all duration-300 z-20 pointer-events-none group-hover/tooltip:pointer-events-auto">
									<!-- Tooltip Arrow -->
									<div class="absolute -bottom-1 right-4 w-2 h-2 bg-gray-800 border-r border-b border-gray-600 transform rotate-45"></div>
									
									<!-- Tooltip Content -->
									<div class="bg-gray-800 border border-gray-600 rounded-lg shadow-2xl p-3 min-w-52">
										<div class="text-xs font-semibold text-gray-300 mb-2">
											Additional Repositories
										</div>
										<div class="space-y-1">
											{project.githubLinks.slice(2).map((repo) => (
												<a
													href={repo.url}
													target="_blank"
													rel="noopener noreferrer"
													class="flex items-center gap-2 px-2 py-1.5 text-sm text-gray-300 hover:text-white hover:bg-gray-700/50 rounded transition-colors"
													title={`View ${repo.label} Repository`}
												>
													<Github size={14} />
													<span class="truncate">{repo.label}</span>
												</a>
											))}
										</div>
									</div>
								</div>
							</div>
						)}
					</div>
				)
			}
		</div>
	</div>

	<!-- Subtle Glow Effect -->
	<div class="absolute inset-0 rounded-2xl bg-gradient-to-br from-emerald-500/5 to-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"></div>
</div>
